
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Notebook 3: Characterization of Long-Term Runoff &#8212; Engineering Hydrology</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Notebook 4: Rational Method and Travel Times" href="../Notebook_4/Notebook_4.html" />
    <link rel="prev" title="Notebook 2: Rating Curve Development" href="../Notebook_2/Notebook_2.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Engineering Hydrology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Foreword
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Introduction/Data_Import_and_Review.html">
   Example: Data Import, Review, and Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Introduction/Example_Notebook.html">
   Example: Clausius-Clapeyron Equation
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../../markdown.html">
   Markdown Files
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Flow Measurement
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_1/Notebook_1.html">
   Notebook 1: Flow Measurement using the Salt Dilution Method
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Rating Curve Development
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_2/Notebook_2.html">
   Notebook 2: Rating Curve Development
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Regional Information Transfer
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Notebook 3: Characterization of Long-Term Runoff
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Rainfall-Runoff Model
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_4/Notebook_4.html">
   Notebook 4: Rational Method and Travel Times
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Extreme Values, Uncertainty, and Risk
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_5/Notebook_5.html">
   Notebook 5: Extreme Values, Uncertainty, and Risk
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/dankovacek/Engineering_Hydrology_Notebooks/main?urlpath=tree/content/notebooks/Notebook_3/Notebook_3.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/dankovacek/Engineering_Hydrology_Notebooks"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/dankovacek/Engineering_Hydrology_Notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Notebook_3/Notebook_3.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/Notebook_3/Notebook_3.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-the-data">
   Import the Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-stage-discharge-rating-curve-and-the-best-fit-curve">
   Plot the Stage-Discharge Rating Curve and the Best Fit Curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-daily-average-discharge">
   Calculate Daily Average Discharge
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-rating-curve-and-resultant-flow-series">
     Plot the Rating Curve and Resultant Flow Series
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#characterizing-water-resources-using-regional-information">
   Characterizing Water Resources using Regional Information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression-of-daily-streamflow">
   Linear Regression of Daily Streamflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#chronological-pairing-cp">
     Chronological Pairing (CP)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#empirical-frequency-pairing">
     Empirical Frequency Pairing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-a-regression">
     Setting up a Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#obtain-concurrent-data">
     Obtain Concurrent Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regression-plot">
   Regression Plot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimate-long-term-daily-flow-at-project-location">
   Estimate Long-Term Daily Flow at Project Location
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-the-modelled-vs-measured-flow">
   Compare the Modelled vs. Measured Flow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-the-above-plot-note-general-patterns-specific-exceptions-and-any-trends">
     In the above plot, note general patterns, specific exceptions, and any trends
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-a-comparison-of-flow-duration-curves">
     Plot a comparison of Flow Duration Curves
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimate-the-long-term-mean-annual-flow-for-our-project-location">
   Estimate the Long-Term Mean Annual Flow for our Project Location
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-reflection">
   Questions for Reflection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Notebook 3: Characterization of Long-Term Runoff</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-the-data">
   Import the Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-stage-discharge-rating-curve-and-the-best-fit-curve">
   Plot the Stage-Discharge Rating Curve and the Best Fit Curve
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-daily-average-discharge">
   Calculate Daily Average Discharge
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-rating-curve-and-resultant-flow-series">
     Plot the Rating Curve and Resultant Flow Series
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#characterizing-water-resources-using-regional-information">
   Characterizing Water Resources using Regional Information
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#linear-regression-of-daily-streamflow">
   Linear Regression of Daily Streamflow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#chronological-pairing-cp">
     Chronological Pairing (CP)
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#empirical-frequency-pairing">
     Empirical Frequency Pairing
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#setting-up-a-regression">
     Setting up a Regression
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#obtain-concurrent-data">
     Obtain Concurrent Data
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#regression-plot">
   Regression Plot
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimate-long-term-daily-flow-at-project-location">
   Estimate Long-Term Daily Flow at Project Location
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#compare-the-modelled-vs-measured-flow">
   Compare the Modelled vs. Measured Flow
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#in-the-above-plot-note-general-patterns-specific-exceptions-and-any-trends">
     In the above plot, note general patterns, specific exceptions, and any trends
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-a-comparison-of-flow-duration-curves">
     Plot a comparison of Flow Duration Curves
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#estimate-the-long-term-mean-annual-flow-for-our-project-location">
   Estimate the Long-Term Mean Annual Flow for our Project Location
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#questions-for-reflection">
   Questions for Reflection
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <section class="tex2jax_ignore mathjax_ignore" id="notebook-3-characterization-of-long-term-runoff">
<h1>Notebook 3: Characterization of Long-Term Runoff<a class="headerlink" href="#notebook-3-characterization-of-long-term-runoff" title="Permalink to this headline">#</a></h1>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">math</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span> <span class="k">as</span> <span class="n">st</span>

<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">register_matplotlib_converters</span>
<span class="n">register_matplotlib_converters</span><span class="p">()</span>

<span class="kn">from</span> <span class="nn">bokeh.plotting</span> <span class="kn">import</span> <span class="n">figure</span><span class="p">,</span> <span class="n">show</span><span class="p">,</span> <span class="n">output_file</span>
<span class="kn">from</span> <span class="nn">bokeh.models</span> <span class="kn">import</span> <span class="n">ColumnDataSource</span><span class="p">,</span> <span class="n">Band</span>
<span class="kn">from</span> <span class="nn">bokeh.io</span> <span class="kn">import</span> <span class="n">output_notebook</span>
<span class="kn">from</span> <span class="nn">bokeh.layouts</span> <span class="kn">import</span> <span class="n">gridplot</span>
<span class="n">output_notebook</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output traceback highlight-ipythontb notranslate"><div class="highlight"><pre><span></span><span class="gt">---------------------------------------------------------------------------</span>
<span class="ne">ModuleNotFoundError</span><span class="g g-Whitespace">                       </span>Traceback (most recent call last)
<span class="nn">Input In [1],</span> in <span class="ni">&lt;cell line: 2&gt;</span><span class="nt">()</span>
<span class="g g-Whitespace">      </span><span class="mi">1</span> <span class="kn">import</span> <span class="nn">math</span>
<span class="ne">----&gt; </span><span class="mi">2</span> <span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="g g-Whitespace">      </span><span class="mi">3</span> <span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="g g-Whitespace">      </span><span class="mi">4</span> <span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span> <span class="k">as</span> <span class="n">st</span>

<span class="ne">ModuleNotFoundError</span>: No module named &#39;pandas&#39;
</pre></div>
</div>
</div>
</div>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p>In Notebook 2, we developed a rating curve for our location of interest based on discrete discharge measurements made during a series of visits, and we applied this stage-discharge relationship (rating curve) to the continous stage recorded at our hydrometric station (the datalogger recording from a pressure transducer).</p>
<p>Recall that our hydrometric station has only been running for a couple of years – this isn’t nearly enough data to estimate the <strong>long term</strong> flow characteristics (daily, seasonal, floods, droughts, etc.).  In this notebook, we look in the vicinity of our project location for other stations where records have been kept for much longer, i.e. several decades longer.  We can use concurrent data from nearby stations to develop a model to estimate flow for periods we didn’t actually measure at our project location.</p>
<p>First, we’ll set up our rating curve as we did in Notebook 2 and rebuild the daily average flow series.</p>
</section>
<section id="import-the-data">
<h2>Import the Data<a class="headerlink" href="#import-the-data" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the stage data</span>
<span class="n">stage_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../Project_Data/Hidden_Creek_stage_data.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
<span class="n">stage_df</span><span class="o">.</span><span class="n">set_index</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="n">stage_df</span><span class="o">.</span><span class="n">sort_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># take a quick look at what we&#39;re dealing with</span>
<span class="n">stage_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">stage_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">])</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the water level (stage) label is long, </span>
<span class="c1"># let&#39;s create a shortcut reference label</span>
<span class="n">stage_label</span> <span class="o">=</span> <span class="s1">&#39;water level (m above 0 flow ref)&#39;</span>
<span class="n">flow_label</span> <span class="o">=</span> <span class="s1">&#39;Flow (m^3/s)&#39;</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import the discharge measurements</span>
<span class="n">rc_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../Project_Data/Project_QH_table_2021.csv&#39;</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># take a look at the discharge measurements</span>
<span class="n">rc_df</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="plot-the-stage-discharge-rating-curve-and-the-best-fit-curve">
<h2>Plot the Stage-Discharge Rating Curve and the Best Fit Curve<a class="headerlink" href="#plot-the-stage-discharge-rating-curve-and-the-best-fit-curve" title="Permalink to this headline">#</a></h2>
<p>Recall from Notebook 2: <span class="math notranslate nohighlight">\(Q = C(H-h_0)^b\)</span>.  If we transform the data to log space, we get a linear relationship:</p>
<div class="math notranslate nohighlight">
\[log(Q) = log(C) + b\cdot log(h-h_0)\]</div>
<p>If we rearrange to the form <span class="math notranslate nohighlight">\(y = intercept + slope \cdot x\)</span>, we can use the scipy function for linear regression (<code class="docutils literal notranslate"> <span class="pre">()</span></code> from the previous tutorial).</p>
<p>Recall the x and y axis parameters are Q and h, respectively, so the linear form of the equation is then:</p>
<div class="math notranslate nohighlight">
\[log(h-h_0) = slope \cdot log(Q) + intercept\]</div>
<p>The above relationship is linear, so we can use ordinary least squares to find the best fit line (in log-log space), and then transform back to linear space.
Note that <span class="math notranslate nohighlight">\(h_0\)</span> cannot be fitted this way, and has to be set manually. In this case we can assume <span class="math notranslate nohighlight">\(h_0=0\)</span>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># calculate the discharge based on the best fit</span>
<span class="c1"># parameters found by ordinary least squares above</span>
<span class="k">def</span> <span class="nf">ols_rc_q</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="n">h0</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate flow (Q) from the linear best fit parameters.</span>
<span class="sd">        -slope: the `log_slope` calculated above (constant)</span>
<span class="sd">        -intercept: `log_intercept` calculated above (constant)</span>
<span class="sd">        -h0 is the same PZF offset used above (constant)</span>
<span class="sd">        -h is the independent variable</span>
<span class="sd">    Returns Q, the discharge in m^3/s.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">slope</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">return</span> <span class="mi">0</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">((</span><span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">h</span> <span class="o">-</span> <span class="n">h0</span><span class="p">)</span> <span class="o">-</span> <span class="n">intercept</span><span class="p">)</span> <span class="o">/</span> <span class="n">slope</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">ValueError</span><span class="p">:</span> 
        <span class="k">return</span> <span class="kc">None</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Find the best-fit line in log-log space</span>
<span class="c1"># take the logarithm of the measured streamflows and stage</span>
<span class="n">h0</span><span class="o">=</span><span class="mi">0</span>
<span class="n">q_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rc_df</span><span class="p">[</span><span class="n">flow_label</span><span class="p">]</span> <span class="o">-</span> <span class="n">h0</span><span class="p">)</span>
<span class="n">stage_log</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">rc_df</span><span class="p">[</span><span class="n">stage_label</span><span class="p">])</span>

<span class="c1"># find the parameters describing the linear best fit using ordinary least squares (OLS)</span>
<span class="n">log_slope</span><span class="p">,</span> <span class="n">log_intercept</span><span class="p">,</span> <span class="n">log_rval</span><span class="p">,</span> <span class="n">log_pval</span><span class="p">,</span> <span class="n">log_stderr</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">q_log</span><span class="p">,</span> <span class="n">stage_log</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stage_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mf">0.001</span><span class="p">,</span> <span class="mf">1.5</span><span class="p">,</span> <span class="mi">100</span><span class="p">)</span>
<span class="c1"># put best fit results into a dataframe for plotting</span>
<span class="c1"># use 0 as the PZF (point of zero flow) (the h0 parameter)</span>
<span class="n">bf_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
<span class="n">bf_df</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_range</span>

<span class="c1"># now as before, apply the `ols_rc_q` function to create the stage-discharge</span>
<span class="c1"># curve based on the best-fit equation</span>
<span class="n">bf_df</span><span class="p">[</span><span class="s1">&#39;best_fit_q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">ols_rc_q</span><span class="p">(</span><span class="n">log_slope</span><span class="p">,</span> <span class="n">log_intercept</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mf">0.0</span><span class="p">)</span> <span class="k">for</span> <span class="n">h</span> <span class="ow">in</span> <span class="n">stage_range</span><span class="p">]</span>
<span class="n">bf_df</span><span class="o">.</span><span class="n">sort_values</span><span class="p">(</span><span class="n">by</span><span class="o">=</span><span class="s1">&#39;stage&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="calculate-daily-average-discharge">
<h2>Calculate Daily Average Discharge<a class="headerlink" href="#calculate-daily-average-discharge" title="Permalink to this headline">#</a></h2>
<p>From the equation describing the ordinary least squares (OLS) best fit of the measured discharge,
calculate daily average flow from daily average water level.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;Value&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">h</span><span class="p">:</span> <span class="n">ols_rc_q</span><span class="p">(</span><span class="n">log_slope</span><span class="p">,</span> <span class="n">log_intercept</span><span class="p">,</span> <span class="n">h</span><span class="p">,</span> <span class="mi">0</span><span class="p">))</span>
<span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_df</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">row</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="s1">&#39;</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">-</span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">],</span> 
                                                                               <span class="n">row</span><span class="p">[</span><span class="s1">&#39;month&#39;</span><span class="p">],</span>
                                                                              <span class="n">row</span><span class="p">[</span><span class="s1">&#39;day&#39;</span><span class="p">])),</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stage_df</span>
</pre></div>
</div>
</div>
</div>
<section id="plot-the-rating-curve-and-resultant-flow-series">
<h3>Plot the Rating Curve and Resultant Flow Series<a class="headerlink" href="#plot-the-rating-curve-and-resultant-flow-series" title="Permalink to this headline">#</a></h3>
<p>The two plots below are linked.  Check the selection tools, and select points on one plot.  When validating data, it is helpful to be able to link the measurements on the rating curve plot and the daily flow series plot.  Consider how you would you check if the low flows were subject to a shift in the hydraulic control over time?</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># output to static HTML file</span>
<span class="c1">#output_file(&quot;filename.html&quot;)</span>

<span class="c1"># customize the tools for interacting with the bokeh plot</span>
<span class="n">TOOLS</span><span class="o">=</span><span class="s2">&quot;pan,wheel_zoom,reset,hover,poly_select,box_select&quot;</span>

<span class="c1"># Bokeh uses a ColumnDataSource data structure to </span>
<span class="c1"># link plots and make them more interactive</span>
<span class="c1"># set data sources for plot linking</span>
<span class="n">stage_df</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">rc_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span>
<span class="n">rc_source</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">rc_source</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">rc_df</span><span class="p">)</span>

<span class="n">ts_source</span> <span class="o">=</span> <span class="n">ColumnDataSource</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="nb">dict</span><span class="p">())</span>
<span class="n">ts_source</span><span class="o">.</span><span class="n">data</span> <span class="o">=</span> <span class="n">ts_source</span><span class="o">.</span><span class="n">from_df</span><span class="p">(</span><span class="n">stage_df</span><span class="p">)</span>

<span class="c1">#### RATING CURVE PLOT (LET)</span>
<span class="n">rc_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Rating Curve Plot&#39;</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">)</span>

<span class="c1"># plot the measured discharge points</span>
<span class="n">rc_plot</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="n">flow_label</span><span class="p">,</span> <span class="n">stage_label</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.5</span><span class="p">,</span>
              <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Measured Q&#39;</span><span class="p">,</span> <span class="n">source</span><span class="o">=</span><span class="n">rc_source</span><span class="p">)</span>

<span class="c1"># plot the rating curve based on the OLS best fit</span>
<span class="n">rc_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">bf_df</span><span class="p">[</span><span class="s1">&#39;best_fit_q&#39;</span><span class="p">],</span> <span class="n">bf_df</span><span class="p">[</span><span class="s1">&#39;stage&#39;</span><span class="p">],</span>
             <span class="n">line_color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;OLS Fit&#39;</span><span class="p">)</span>

<span class="c1">#### DAILY FLOW SERIES PLOT (RIGHT)</span>
<span class="n">daily_flow_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="mi">550</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> 
                        <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Daily Flow Hydrograph&#39;</span><span class="p">)</span>

<span class="c1"># # plot the flow series based on the OLS best fit</span>
<span class="n">daily_flow_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">,</span> 
                    <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;OLS-based RC Flow&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span>
                    <span class="n">source</span><span class="o">=</span><span class="n">ts_source</span><span class="p">)</span>

<span class="c1"># plot the daily flow series generated from the manual rating curve</span>
<span class="n">daily_flow_plot</span><span class="o">.</span><span class="n">circle</span><span class="p">(</span><span class="s1">&#39;Date&#39;</span><span class="p">,</span> <span class="n">flow_label</span><span class="p">,</span> <span class="n">size</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.8</span><span class="p">,</span>
              <span class="n">source</span><span class="o">=</span><span class="n">rc_source</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Measured Q&#39;</span><span class="p">)</span>

<span class="c1"># daily_flow_plot.line(&#39;Date&#39;, &#39;RC Q (cms)&#39;)</span>
<span class="c1"># label the axes</span>
<span class="n">daily_flow_plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Date&#39;</span>
<span class="n">daily_flow_plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Flow (m³/s)&#39;</span>
<span class="n">daily_flow_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;top_left&quot;</span>
<span class="n">rc_plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Flow (m³/s)&#39;</span>
<span class="n">rc_plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Stage (m)&#39;</span>
<span class="n">rc_plot</span><span class="o">.</span><span class="n">legend</span><span class="o">.</span><span class="n">location</span> <span class="o">=</span> <span class="s2">&quot;bottom_right&quot;</span>

<span class="n">layout</span> <span class="o">=</span> <span class="n">gridplot</span><span class="p">([[</span><span class="n">rc_plot</span><span class="p">,</span> <span class="n">daily_flow_plot</span><span class="p">]])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># show the results</span>
<span class="n">show</span><span class="p">(</span><span class="n">layout</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="characterizing-water-resources-using-regional-information">
<h2>Characterizing Water Resources using Regional Information<a class="headerlink" href="#characterizing-water-resources-using-regional-information" title="Permalink to this headline">#</a></h2>
<p>Below are a few points to consider regarding the characterization of the water resource over the <strong>long term</strong>.</p>
<ol class="simple">
<li><p>How long has the hydrometric station been operating?</p></li>
<li><p>If we’re collecting data to support civil engineering design, to assess financial viability of a project, to inform operations, and to quantify the impact of our use of water resources or our modification of natural flow regimes, have we collected enough data?</p></li>
<li><p>How much data is enough?</p></li>
<li><p>If we don’t have enough, what can we do to better evaluate the water resource?</p></li>
</ol>
</section>
<section id="linear-regression-of-daily-streamflow">
<h2>Linear Regression of Daily Streamflow<a class="headerlink" href="#linear-regression-of-daily-streamflow" title="Permalink to this headline">#</a></h2>
<p><img alt="Active WSC Stations in Western Canada" src="../../_images/wsc_map_view1.png" /></p>
<p>Water Survey of Canada (WSC) has operated and maintained hydrometric stations across Canada for over 100 years.  If we can find a regional proxy WSC station in <strong>close proximity to our location of interest, with similar basin characteristics</strong> to those of our project, we can correlate daily streamflow between the two locations, ultimately to generate an estimated (or synthetic) long-term flow series for our project location.</p>
<p>Typically regressions are done by chronological pairing, which effectively says “if the flow at the regional (proxy) station was <span class="math notranslate nohighlight">\(Q_p\)</span> at time <span class="math notranslate nohighlight">\(t\)</span>, the flow at our project location at time <span class="math notranslate nohighlight">\(t\)</span> will be approximately <span class="math notranslate nohighlight">\(C\cdot Q_p + D\)</span> where <span class="math notranslate nohighlight">\(C\)</span> and <span class="math notranslate nohighlight">\(D\)</span> are constants.</p>
<section id="chronological-pairing-cp">
<h3>Chronological Pairing (CP)<a class="headerlink" href="#chronological-pairing-cp" title="Permalink to this headline">#</a></h3>
<p>A lot of work goes into finding an appropriate long-term record comparable to our location of interest, but we will assume we have been given a long-term daily flow series to use.</p>
<ol class="simple">
<li><p>Find just the concurrent days of record (days where we have flow recorded for both creeks/rivers).</p></li>
<li><p>Create a scatter plot where the coordinates of each data point are (flow1, flow2).  It is customary to put the long-term regional station on the x-axis.</p></li>
<li><p>Determine the equation describing the line of best fit through the data.</p></li>
<li><p>Apply the best fit line equation to the long-term surrogate record to yield an estimated long-term series for the project location.</p></li>
</ol>
<p>To further refine this estimate, we can recognize that the mechanisms driving flow across seasons and months can change quite dramatically, and the relationship between the two catchments can also change month-by-month, and/or season by season.  If there is enough data to create seasonal or monthly regressions, we can develop a best-fit equation for each month or season.  The process of steps 2 through 4 then are the same, except we treat each season or month independently.</p>
<p>The above method is referred to as <strong>chronological pairing (CP)</strong>, as it pairs flow that occurs on the same day.  But what if there are timing differences between stations, or what if the spatial variability of precipitation results in flow events that don’t coincide in the short term?</p>
</section>
<section id="empirical-frequency-pairing">
<h3>Empirical Frequency Pairing<a class="headerlink" href="#empirical-frequency-pairing" title="Permalink to this headline">#</a></h3>
<p>To eliminate the temporal constraint on timing of events at the daily level, instead of comparing concurrent days, we can compare magnitudes of flows. This method is referred to as Empirical Frequency Pairing (EFP) and is commonly used in British Columbia.  Empirical frequency pairing still uses concurrent records, however it is the ranked flows in each series that are compared, i.e. the data points on an EFP plot are:</p>
<div class="math notranslate nohighlight">
\[[(R1_{siteA}, R1_{site_B}), (R2_{siteA}, R2_{siteB}), ..., (Rn_{siteA}, Rn_{siteB})]\]</div>
<p>The steps to derive an estimated long-term flow series for our location of interest are the same (i.e. steps 2-4 above).</p>
</section>
<section id="setting-up-a-regression">
<h3>Setting up a Regression<a class="headerlink" href="#setting-up-a-regression" title="Permalink to this headline">#</a></h3>
<p>The first step is to import the regional data series and find all of the dates with values for both locations.</p>
<p>Previewing the data shows line 1 has information about two distinct parameters.  Where the <code class="docutils literal notranslate"><span class="pre">PARAM</span></code> column value is 1, the <code class="docutils literal notranslate"><span class="pre">Value</span></code> column corresponds to daily discharge (<span class="math notranslate nohighlight">\(\frac{m^3}{s}\)</span> and where the <code class="docutils literal notranslate"><span class="pre">PARAM</span></code> column value is 2, the <code class="docutils literal notranslate"><span class="pre">Value</span></code> column corresonds to daily water level (<span class="math notranslate nohighlight">\(m\)</span>).  We need to correctly set the header line to index 1 (the second row), so that the headings are read correctly.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">flow_de</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;Stave Daily Avg Flow.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Dates&#39;</span><span class="p">)</span>
<span class="n">flow_de</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">flow_de</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>

<span class="nb">print</span><span class="p">(</span><span class="n">flow_de</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">))</span>

<span class="n">flow_de</span> <span class="o">=</span> <span class="n">flow_de</span><span class="o">.</span><span class="n">dropna</span><span class="p">()</span>

<span class="n">max_de</span> <span class="o">=</span> <span class="n">flow_de</span><span class="o">.</span><span class="n">loc</span><span class="p">[</span><span class="n">flow_de</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)[</span><span class="s1">&#39;flow&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">idxmax</span><span class="p">()]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">max_de</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">10</span><span class="p">)</span>
<span class="n">max_de</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;max_de.csv&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># set the header row to index 1, tell the function to set the `Date` column as the index.</span>
<span class="c1"># If you look at the raw csv file, you&#39;ll see that there&#39;s an information line at the very top,</span>
<span class="c1"># and the second line (index 1 in programming) is where the column headers are</span>
<span class="n">regional_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../data/Stave Daily Avg Flow.csv&#39;</span><span class="p">,</span> <span class="n">header</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">parse_dates</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">index_col</span><span class="o">=</span><span class="s1">&#39;Date&#39;</span><span class="p">)</span>

<span class="c1"># select only the discharge data (PARAM == 1)</span>
<span class="n">regional_df</span> <span class="o">=</span> <span class="n">regional_df</span><span class="p">[</span><span class="n">regional_df</span><span class="p">[</span><span class="s1">&#39;PARAM&#39;</span><span class="p">]</span> <span class="o">==</span> <span class="mi">1</span><span class="p">]</span>
<span class="c1"># </span>
<span class="c1"># regional_df.columns = [&#39;ID&#39;, &#39;PARAM&#39;, &#39;year&#39;, &#39;month&#39;, &#39;day&#39; &#39;Regional Flow (m^3/s)&#39;, &#39;SYM&#39;]</span>
<span class="c1"># </span>
<span class="c1"># preview the data</span>
<span class="n">regional_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># check the date range covered by the regional data</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;REGIONAL DATA: Start date = </span><span class="si">{}</span><span class="s1">, End date = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">regional_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">regional_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>

<span class="c1"># check the date range covered by our data measured at site</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;SITE DATA: Start date = </span><span class="si">{}</span><span class="s1">, End date = </span><span class="si">{}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">stage_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">stage_df</span><span class="o">.</span><span class="n">index</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="obtain-concurrent-data">
<h3>Obtain Concurrent Data<a class="headerlink" href="#obtain-concurrent-data" title="Permalink to this headline">#</a></h3>
<p>In the previous step, we can see that the regional dataset encompasses the date range of our site data.  To perform a regression, we want to use concurrent data only.   The <code class="docutils literal notranslate"><span class="pre">concat</span></code>, or concatenate, function <a class="reference external" href="https://pandas.pydata.org/pandas-docs/stable/reference/api/pandas.concat.html">documentation can be found here</a>.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">regional_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stage_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">stage_df</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># create a new dataframe of concurrent data and plot the data</span>
<span class="c1"># join=&#39;inner&#39; says to line up the indices and get the values that are common between the two dataframes</span>
<span class="c1"># axis=1 says line up columns instead of rows</span>
<span class="c1"># print(regional_df)</span>
<span class="n">stage_df</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;Date&#39;</span><span class="p">])</span>



<span class="n">concurrent_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stage_df</span><span class="p">,</span> <span class="n">regional_df</span><span class="p">],</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># stage_df.index = pd.to_datetime(stage_df.index)</span>
<span class="c1"># </span>
<span class="c1"># filter just the columns we want</span>
<span class="n">concurrent_df</span> <span class="o">=</span> <span class="n">concurrent_df</span><span class="p">[[</span><span class="s1">&#39;flow&#39;</span><span class="p">,</span> <span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">]]</span>
<span class="c1"># not rename the columns to something that is more indicative of the location of each data source</span>
<span class="n">concurrent_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Regional_Q&#39;</span><span class="p">,</span> <span class="s1">&#39;Project_Q&#39;</span><span class="p">]</span>

<span class="c1"># concurrent_df = concurrent_df[concurrent_df[&#39;Regional_Q&#39;] &lt; 6.0]</span>

<span class="n">concurrent_df</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>

<span class="n">concurrent_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># find the best fit equation</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">rval</span><span class="p">,</span> <span class="n">pval</span><span class="p">,</span> <span class="n">stderr</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">concurrent_df</span><span class="p">[</span><span class="s1">&#39;Regional_Q&#39;</span><span class="p">],</span> <span class="n">concurrent_df</span><span class="p">[</span><span class="s1">&#39;Project_Q&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">slope</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="regression-plot">
<h2>Regression Plot<a class="headerlink" href="#regression-plot" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#### Regression Plot</span>
<span class="n">reg_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Regression Plot (All Concurrent Data)&#39;</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">)</span>

<span class="c1"># plot the concurrent daily flows</span>
<span class="n">reg_plot</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">concurrent_df</span><span class="p">[</span><span class="s1">&#39;Regional_Q&#39;</span><span class="p">],</span> <span class="n">concurrent_df</span><span class="p">[</span><span class="s1">&#39;Project_Q&#39;</span><span class="p">],</span>
                <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>

<span class="c1">#plot the best fit</span>
<span class="n">q_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">concurrent_df</span><span class="p">[</span><span class="s1">&#39;Regional_Q&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span> <span class="mi">500</span><span class="p">)</span>
<span class="n">intercept</span> <span class="o">=</span> <span class="mf">0.2</span>
<span class="n">slope</span> <span class="o">=</span> <span class="mf">0.15</span>
<span class="n">reg_line</span> <span class="o">=</span> <span class="p">[</span><span class="n">slope</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="n">intercept</span> <span class="k">for</span> <span class="n">q</span> <span class="ow">in</span> <span class="n">q_range</span><span class="p">]</span>

<span class="n">reg_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">q_range</span><span class="p">,</span> <span class="n">reg_line</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Q = </span><span class="si">{:.1f}</span><span class="s1">*Qregional + </span><span class="si">{:.1f}</span><span class="s1">&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">),</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;firebrick&#39;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">reg_plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Regional Station Daily Avg. Flow (m^3/s)&#39;</span>
<span class="n">reg_plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Project Location Daily Avg. Flow (m^3/s)&#39;</span>
<span class="n">show</span><span class="p">(</span><span class="n">reg_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="estimate-long-term-daily-flow-at-project-location">
<h2>Estimate Long-Term Daily Flow at Project Location<a class="headerlink" href="#estimate-long-term-daily-flow-at-project-location" title="Permalink to this headline">#</a></h2>
<p>The last step in the process of a long-term flow estimate for our project location is to use the equation of the best fit line (the model) to calculate estimated daily flows over periods where flow was not measured at our project location.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lt_series</span> <span class="o">=</span> <span class="n">regional_df</span><span class="o">.</span><span class="n">copy</span><span class="p">()[[</span><span class="s1">&#39;flow&#39;</span><span class="p">]]</span>
<span class="n">lt_series</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Regional_Q&#39;</span><span class="p">]</span>
<span class="c1"># map the equation of the best fit line to the regional flow series</span>
<span class="n">lt_series</span><span class="p">[</span><span class="s1">&#39;Proj_Q&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lt_series</span><span class="o">.</span><span class="n">apply</span><span class="p">(</span><span class="k">lambda</span> <span class="n">q</span><span class="p">:</span> <span class="n">slope</span> <span class="o">*</span> <span class="n">q</span> <span class="o">+</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="compare-the-modelled-vs-measured-flow">
<h2>Compare the Modelled vs. Measured Flow<a class="headerlink" href="#compare-the-modelled-vs-measured-flow" title="Permalink to this headline">#</a></h2>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">stage_df</span><span class="p">,</span> <span class="n">lt_series</span><span class="p">],</span> <span class="n">join</span><span class="o">=</span><span class="s1">&#39;inner&#39;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="c1"># keep only the measured and modeled columns</span>
<span class="n">mod_df</span> <span class="o">=</span> <span class="n">mod_df</span><span class="p">[[</span><span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">,</span> <span class="s1">&#39;Proj_Q&#39;</span><span class="p">]]</span>
<span class="c1"># rename the columns to something more intuitive</span>
<span class="n">mod_df</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;Measured_Q&#39;</span><span class="p">,</span> <span class="s1">&#39;Modeled_Q&#39;</span><span class="p">]</span>

<span class="n">reg_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">plot_width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">plot_height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span>
                <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Measured vs. Modeled Daily Avg. Flow&#39;</span><span class="p">,</span>
                <span class="n">tools</span><span class="o">=</span><span class="n">TOOLS</span><span class="p">,</span> <span class="n">x_axis_type</span><span class="o">=</span><span class="s1">&#39;datetime&#39;</span><span class="p">)</span>

<span class="n">reg_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">mod_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mod_df</span><span class="p">[</span><span class="s1">&#39;Measured_Q&#39;</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Measured Q&#39;</span><span class="p">)</span>

<span class="n">reg_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">mod_df</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">mod_df</span><span class="p">[</span><span class="s1">&#39;Modeled_Q&#39;</span><span class="p">],</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Modeled Q&#39;</span><span class="p">,</span>
             <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>

<span class="n">show</span><span class="p">(</span><span class="n">reg_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<section id="in-the-above-plot-note-general-patterns-specific-exceptions-and-any-trends">
<h3>In the above plot, note general patterns, specific exceptions, and any trends<a class="headerlink" href="#in-the-above-plot-note-general-patterns-specific-exceptions-and-any-trends" title="Permalink to this headline">#</a></h3>
<p>Note the big deviation between the two series in the summer of 2010.  This looks like our model is doing a particularly bad job in the late summer.  How about in other seasons?   How is the model doing at predicting peaks?</p>
<p>How else can we evaluate how the model is fitting the measured data, noting in particular that we are interested in certain ranges of flows, perhaps for generating energy year-round, or supplying a community with drinking water in a dry season?</p>
<p>Recall how we plotted the flow duration curve in Notebook 3.  The flow duration curve is particularly useful for focusing on how well the model matches measured data across the range of flows (though extremes are de-emphasized).</p>
</section>
<section id="plot-a-comparison-of-flow-duration-curves">
<h3>Plot a comparison of Flow Duration Curves<a class="headerlink" href="#plot-a-comparison-of-flow-duration-curves" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">mod_df</span><span class="p">[</span><span class="s1">&#39;Modeled_Q&#39;</span><span class="p">])</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pct_exceeded</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">)</span>
<span class="n">mod_df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">msd_quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mod_df</span><span class="p">[</span><span class="s1">&#39;Measured_Q&#39;</span><span class="p">],</span> <span class="n">pct_exceeded</span><span class="p">)</span>
<span class="n">modeled_quantiles</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">mod_df</span><span class="p">[</span><span class="s1">&#39;Modeled_Q&#39;</span><span class="p">],</span> <span class="n">pct_exceeded</span><span class="p">)</span>

<span class="n">fdc_plot</span> <span class="o">=</span> <span class="n">figure</span><span class="p">(</span><span class="n">width</span><span class="o">=</span><span class="mi">700</span><span class="p">,</span> <span class="n">height</span><span class="o">=</span><span class="mi">400</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s1">&#39;Measured vs. Modeled Flow Duration Curve&#39;</span><span class="p">)</span>
<span class="n">fdc_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">pct_exceeded</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">msd_quantiles</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s2">&quot;Measured&quot;</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;dodgerblue&#39;</span><span class="p">)</span>
<span class="n">fdc_plot</span><span class="o">.</span><span class="n">line</span><span class="p">(</span><span class="n">pct_exceeded</span><span class="p">[::</span><span class="o">-</span><span class="mi">1</span><span class="p">],</span> <span class="n">modeled_quantiles</span><span class="p">,</span> <span class="n">line_width</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
             <span class="n">color</span><span class="o">=</span><span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="n">legend_label</span><span class="o">=</span><span class="s1">&#39;Modeled&#39;</span><span class="p">,</span> <span class="n">line_dash</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">)</span>
<span class="n">fdc_plot</span><span class="o">.</span><span class="n">yaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Flow [m^3/s]&#39;</span>
<span class="n">fdc_plot</span><span class="o">.</span><span class="n">xaxis</span><span class="o">.</span><span class="n">axis_label</span> <span class="o">=</span> <span class="s1">&#39;Percent of Time Exceeded [%]&#39;</span>
<span class="n">show</span><span class="p">(</span><span class="n">fdc_plot</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="estimate-the-long-term-mean-annual-flow-for-our-project-location">
<h2>Estimate the Long-Term Mean Annual Flow for our Project Location<a class="headerlink" href="#estimate-the-long-term-mean-annual-flow-for-our-project-location" title="Permalink to this headline">#</a></h2>
<p>Compare the long term mean annual against the short term, then compare the long-term monthly and annual series.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lt_mad</span> <span class="o">=</span> <span class="n">lt_series</span><span class="p">[[</span><span class="s1">&#39;Proj_Q&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">msd_mean</span> <span class="o">=</span> <span class="n">stage_df</span><span class="p">[[</span><span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>
<span class="n">lt_series</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">lt_median</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">lt_series</span><span class="p">[</span><span class="s1">&#39;Proj_Q&#39;</span><span class="p">],</span> <span class="mi">50</span><span class="p">)</span>
<span class="n">msd_median</span> <span class="o">=</span> <span class="n">stage_df</span><span class="p">[[</span><span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">median</span><span class="p">()</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()[</span><span class="mi">0</span><span class="p">]</span>

<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The mean annual flow (MAD) at our project location is </span><span class="si">{:.1f}</span><span class="s1"> m^3/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lt_mad</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To compare, the average flow over the measured period was </span><span class="si">{:.1f}</span><span class="s1"> m^3/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msd_mean</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;The median flow for the long-term period was </span><span class="si">{:.1f}</span><span class="s1"> m^3/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lt_median</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s1">&#39;To compare, the median flow over the measured period was </span><span class="si">{:.1f}</span><span class="s1"> m^3/s&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">msd_median</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">lt_series</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">lt_series</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
<span class="n">annual_series</span> <span class="o">=</span> <span class="n">lt_series</span><span class="p">[[</span><span class="s1">&#39;Proj_Q&#39;</span><span class="p">,</span> <span class="s1">&#39;year&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">stage_df</span><span class="p">[</span><span class="s1">&#39;year&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">stage_df</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">year</span>
<span class="n">msd_ann</span> <span class="o">=</span> <span class="n">stage_df</span><span class="p">[[</span><span class="s1">&#39;year&#39;</span><span class="p">,</span> <span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">]]</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s1">&#39;year&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">annual_series</span><span class="p">[</span><span class="s1">&#39;Proj_Q&#39;</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LT Modelled&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">plot</span><span class="p">([</span><span class="mi">1987</span><span class="p">,</span> <span class="mi">2017</span><span class="p">],</span> <span class="p">[</span><span class="n">lt_mad</span><span class="p">,</span> <span class="n">lt_mad</span><span class="p">],</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;LT Mean&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">msd_ann</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">msd_ann</span><span class="p">[</span><span class="s1">&#39;RC Q (cms)&#39;</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Mean Annual Series&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="questions-for-reflection">
<h2>Questions for Reflection<a class="headerlink" href="#questions-for-reflection" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>From our regression plot and from the comparison of measured and estimated daily flow series, what do you think about the quality of our model, i.e. how well does the best fit line approximate the concurrent daily flows (blue dots)?</p></li>
<li><p>What range of flow is exceeded 67% OR MORE of the time, how well is this range modelled and what might this flow range be pertinent to?</p></li>
<li><p>What could differences in concurrent flows at the two locations be attributable to?</p></li>
<li><p>How might we modify our model to capture one of the differences you noted in 3?</p></li>
<li><p>In the last plot, we see that the ~two years we measured flow at our project location were very close to the long-term mean annual.  What if the two years we happened to measure were 2000 and 2001 and we took these as representative without doing a regression analysis with a long-term regional record?</p></li>
</ol>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>A.S. Hamilton &amp; R.D. Moore (2012). Quantifying Uncertainty in Streamflow Records , Canadian Water Resources Journal / Revue canadienne des ressources hydriques, 37:1, 3-21, DOI: 10.4296/cwrj3701865</p></li>
<li><p>Environment Canada (2012).  Hydrometric Manual - Data Computations.  Water Survey of Canada, Weather and Environmental Monitoring Directorate.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/Notebook_3"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../Notebook_2/Notebook_2.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Notebook 2: Rating Curve Development</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../Notebook_4/Notebook_4.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebook 4: Rational Method and Travel Times</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dan Kovacek<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>