
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Notebook 1: Flow Measurement using the Salt Dilution Method &#8212; Engineering Hydrology</title>
    
  <!-- Loaded before other Sphinx assets -->
  <link href="../../_static/styles/theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">
<link href="../../_static/styles/pydata-sphinx-theme.css?digest=1999514e3f237ded88cf" rel="stylesheet">

    
  <link rel="stylesheet"
    href="../../_static/vendor/fontawesome/5.13.0/css/all.min.css">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-solid-900.woff2">
  <link rel="preload" as="font" type="font/woff2" crossorigin
    href="../../_static/vendor/fontawesome/5.13.0/webfonts/fa-brands-400.woff2">

    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css" />
    <link rel="stylesheet" href="../../_static/styles/sphinx-book-theme.css?digest=5115cc725059bd94278eecd172e13a965bf8f5a9" type="text/css" />
    <link rel="stylesheet" type="text/css" href="../../_static/togglebutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/mystnb.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css" />
    <link rel="stylesheet" type="text/css" href="../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" />
    
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf">

    <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js"></script>
    <script src="../../_static/jquery.js"></script>
    <script src="../../_static/underscore.js"></script>
    <script src="../../_static/doctools.js"></script>
    <script src="../../_static/clipboard.min.js"></script>
    <script src="../../_static/copybutton.js"></script>
    <script src="../../_static/scripts/sphinx-book-theme.js?digest=9c920249402e914e316237a7dbc6769907cce411"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../../_static/togglebutton.js"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown, .tag_hide_input div.cell_input, .tag_hide-input div.cell_input, .tag_hide_output div.cell_output, .tag_hide-output div.cell_output, .tag_hide_cell.cell, .tag_hide-cell.cell';</script>
    <script src="../../_static/design-tabs.js"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"
const thebe_selector = ".thebe,.cell"
const thebe_selector_input = "pre"
const thebe_selector_output = ".output, .cell_output"
</script>
    <script async="async" src="../../_static/sphinx-thebe.js"></script>
    <script>window.MathJax = {"options": {"processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" />
    <link rel="next" title="Notebook 2: Rating Curve Development" href="../Notebook_2/Notebook_2.html" />
    <link rel="prev" title="Example: Clausius-Clapeyron Equation" href="../Introduction/Example_Notebook.html" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="docsearch:language" content="None">
    

    <!-- Google Analytics -->
    
  </head>
  <body data-spy="scroll" data-target="#bd-toc-nav" data-offset="60">
<!-- Checkboxes to toggle the left sidebar -->
<input type="checkbox" class="sidebar-toggle" name="__navigation" id="__navigation" aria-label="Toggle navigation sidebar">
<label class="overlay overlay-navbar" for="__navigation">
    <div class="visually-hidden">Toggle navigation sidebar</div>
</label>
<!-- Checkboxes to toggle the in-page toc -->
<input type="checkbox" class="sidebar-toggle" name="__page-toc" id="__page-toc" aria-label="Toggle in-page Table of Contents">
<label class="overlay overlay-pagetoc" for="__page-toc">
    <div class="visually-hidden">Toggle in-page Table of Contents</div>
</label>
<!-- Headers at the top -->
<div class="announcement header-item noprint"></div>
<div class="header header-item noprint"></div>

    
    <div class="container-fluid" id="banner"></div>

    

    <div class="container-xl">
      <div class="row">
          
<!-- Sidebar -->
<div class="bd-sidebar noprint" id="site-navigation">
    <div class="bd-sidebar__content">
        <div class="bd-sidebar__top"><div class="navbar-brand-box">
    <a class="navbar-brand text-wrap" href="../../index.html">
      
        <!-- `logo` is deprecated in Sphinx 4.0, so remove this when we stop supporting 3 -->
        
      
      
      <img src="../../_static/logo.png" class="logo" alt="logo">
      
      
      <h1 class="site-logo" id="site-title">Engineering Hydrology</h1>
      
    </a>
</div><form class="bd-search d-flex align-items-center" action="../../search.html" method="get">
  <i class="icon fas fa-search"></i>
  <input type="search" class="form-control" name="q" id="search-input" placeholder="Search this book..." aria-label="Search this book..." autocomplete="off" >
</form><nav class="bd-links" id="bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1">
                <a class="reference internal" href="../../intro.html">
                    Foreword
                </a>
            </li>
        </ul>
        <p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Introduction
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Introduction/Data_Import_and_Review.html">
   Example: Data Import, Review, and Workflow
  </a>
 </li>
 <li class="toctree-l1">
  <a class="reference internal" href="../Introduction/Example_Notebook.html">
   Example: Clausius-Clapeyron Equation
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Flow Measurement
 </span>
</p>
<ul class="current nav bd-sidenav">
 <li class="toctree-l1 current active">
  <a class="current reference internal" href="#">
   Notebook 1: Flow Measurement using the Salt Dilution Method
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Rating Curve Development
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_2/Notebook_2.html">
   Notebook 2: Rating Curve Development
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Regional Information Transfer
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_3/Notebook_3.html">
   Notebook 3: Regional Information Transfer
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Rainfall-Runoff Model
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_4/Notebook_4.html">
   Notebook 4: Modelling
  </a>
 </li>
</ul>
<p aria-level="2" class="caption" role="heading">
 <span class="caption-text">
  Extreme Values, Uncertainty, and Risk
 </span>
</p>
<ul class="nav bd-sidenav">
 <li class="toctree-l1">
  <a class="reference internal" href="../Notebook_5/Notebook_5.html">
   Notebook 5: Extreme Values, Uncertainty, and Risk
  </a>
 </li>
</ul>

    </div>
</nav></div>
        <div class="bd-sidebar__bottom">
             <!-- To handle the deprecated key -->
            
            <div class="navbar_extra_footer">
            Powered by <a href="https://jupyterbook.org">Jupyter Book</a>
            </div>
            
        </div>
    </div>
    <div id="rtd-footer-container"></div>
</div>


          


          
<!-- A tiny helper pixel to detect if we've scrolled -->
<div class="sbt-scroll-pixel-helper"></div>
<!-- Main content -->
<div class="col py-0 content-container">
    
    <div class="header-article row sticky-top noprint">
        



<div class="col py-1 d-flex header-article-main">
    <div class="header-article__left">
        
        <label for="__navigation"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="right"
title="Toggle navigation"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-bars"></i>
  </span>

</label>

        
    </div>
    <div class="header-article__right">
<div class="menu-dropdown menu-dropdown-launch-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Launch interactive content">
      <i class="fas fa-rocket"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://mybinder.org/v2/gh/dankovacek/Engineering_Hydrology_Notebooks/main?urlpath=tree/content/notebooks/Notebook_1/Notebook_1.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Launch on Binder"
>
  

<span class="headerbtn__icon-container">
  
    <img src="../../_static/images/logo_binder.svg">
  </span>
<span class="headerbtn__text-container">Binder</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<button onclick="toggleFullScreen()"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="bottom"
title="Fullscreen mode"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>

<div class="menu-dropdown menu-dropdown-repository-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Source repositories">
      <i class="fab fa-github"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="https://github.com/dankovacek/Engineering_Hydrology_Notebooks"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Source repository"
>
  

<span class="headerbtn__icon-container">
  <i class="fab fa-github"></i>
  </span>
<span class="headerbtn__text-container">repository</span>
</a>

      </li>
      
      <li>
        <a href="https://github.com/dankovacek/Engineering_Hydrology_Notebooks/issues/new?title=Issue%20on%20page%20%2Fnotebooks/Notebook_1/Notebook_1.html&body=Your%20issue%20content%20here."
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Open an issue"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-lightbulb"></i>
  </span>
<span class="headerbtn__text-container">open issue</span>
</a>

      </li>
      
    </ul>
  </div>
</div>

<div class="menu-dropdown menu-dropdown-download-buttons">
  <button class="headerbtn menu-dropdown__trigger"
      aria-label="Download this page">
      <i class="fas fa-download"></i>
  </button>
  <div class="menu-dropdown__content">
    <ul>
      <li>
        <a href="../../_sources/notebooks/Notebook_1/Notebook_1.ipynb"
   class="headerbtn"
   data-toggle="tooltip"
data-placement="left"
title="Download source file"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="headerbtn__text-container">.ipynb</span>
</a>

      </li>
      
      <li>
        
<button onclick="printPdf(this)"
  class="headerbtn"
  data-toggle="tooltip"
data-placement="left"
title="Print to PDF"
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="headerbtn__text-container">.pdf</span>
</button>

      </li>
      
    </ul>
  </div>
</div>
<label for="__page-toc"
  class="headerbtn headerbtn-page-toc"
  
>
  

<span class="headerbtn__icon-container">
  <i class="fas fa-list"></i>
  </span>

</label>

    </div>
</div>

<!-- Table of contents -->
<div class="col-md-3 bd-toc show noprint">
    <div class="tocsection onthispage pt-5 pb-3">
        <i class="fas fa-list"></i> Contents
    </div>
    <nav id="bd-toc-nav" aria-label="Page">
        <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#given-information">
     Given Information:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-the-salt-dilution-data">
   Import the Salt Dilution Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-calibration-and-best-fit-line">
   Plot the calibration and best fit line
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#best-fit-slope-and-coefficient-of-determination-r-2-of-calibration-points">
     Best Fit slope and coefficient of determination (
     <span class="math notranslate nohighlight">
      \(R^2\)
     </span>
     ) of calibration points
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-measurement">
   Flow measurement
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-salt-dilution-measurement">
     Plot the salt dilution measurement
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-background-and-measurement-periods">
     Specify background and measurement periods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-discharge">
   Calculate Discharge
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notebook-reflection">
   Notebook Reflection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-1">
     Question 1:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-2">
     Question 2:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-info">
   Additional Info
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#temperature-compensation-for-conductivity">
     Temperature Compensation for Conductivity
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

    </nav>
</div>
    </div>
    <div class="article row">
        <div class="col pl-md-3 pl-lg-5 content-container">
            <!-- Table of contents that is only displayed when printing the page -->
            <div id="jb-print-docs-body" class="onlyprint">
                <h1>Notebook 1: Flow Measurement using the Salt Dilution Method</h1>
                <!-- Table of contents -->
                <div id="print-main-content">
                    <div id="jb-print-toc">
                        
                        <div>
                            <h2> Contents </h2>
                        </div>
                        <nav aria-label="Page">
                            <ul class="visible nav section-nav flex-column">
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#introduction">
   Introduction
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#given-information">
     Given Information:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#import-the-salt-dilution-data">
   Import the Salt Dilution Data
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#plot-the-calibration-and-best-fit-line">
   Plot the calibration and best fit line
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#best-fit-slope-and-coefficient-of-determination-r-2-of-calibration-points">
     Best Fit slope and coefficient of determination (
     <span class="math notranslate nohighlight">
      \(R^2\)
     </span>
     ) of calibration points
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#flow-measurement">
   Flow measurement
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#plot-the-salt-dilution-measurement">
     Plot the salt dilution measurement
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#specify-background-and-measurement-periods">
     Specify background and measurement periods
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#calculate-discharge">
   Calculate Discharge
  </a>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#notebook-reflection">
   Notebook Reflection
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-1">
     Question 1:
    </a>
   </li>
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#question-2">
     Question 2:
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#additional-info">
   Additional Info
  </a>
  <ul class="nav section-nav flex-column">
   <li class="toc-h3 nav-item toc-entry">
    <a class="reference internal nav-link" href="#temperature-compensation-for-conductivity">
     Temperature Compensation for Conductivity
    </a>
   </li>
  </ul>
 </li>
 <li class="toc-h2 nav-item toc-entry">
  <a class="reference internal nav-link" href="#references">
   References
  </a>
 </li>
</ul>

                        </nav>
                    </div>
                </div>
            </div>
            <main id="main-content" role="main">
                
              <div>
                
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># import libraries</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">math</span>

<span class="c1"># plotting library</span>
<span class="kn">from</span> <span class="nn">matplotlib</span> <span class="kn">import</span> <span class="n">pyplot</span> <span class="k">as</span> <span class="n">plt</span>
<span class="c1"># advanced statistics library</span>
<span class="kn">from</span> <span class="nn">scipy</span> <span class="kn">import</span> <span class="n">stats</span>
</pre></div>
</div>
</div>
</div>
<section class="tex2jax_ignore mathjax_ignore" id="notebook-1-flow-measurement-using-the-salt-dilution-method">
<h1>Notebook 1: Flow Measurement using the Salt Dilution Method<a class="headerlink" href="#notebook-1-flow-measurement-using-the-salt-dilution-method" title="Permalink to this headline">#</a></h1>
<section id="introduction">
<h2>Introduction<a class="headerlink" href="#introduction" title="Permalink to this headline">#</a></h2>
<p><a class="reference external" href="https://doi.org/10.1002/hyp.3360070212">Flow measurement by salt dilution</a><span class="math notranslate nohighlight">\(^{[1]}\)</span> is a type of tracer method where the natural conductivity of stream water is temporarily raised by adding (dissolving) a known mass of tracer into the stream, and measuring a response downstream.  Tracer methods can be done by slug injection or steady-state.  A “slug” is a known mass of tracer that dissolves and mixes in the stream.  The steady-state method is a constant injection of a dissolved tracer of known concentration.  Both methods are suited to lower flows where a sufficient signal-to-noise ratio can be acheived with a relatively small amount of tracer, and to turbulent flows where adequate mixing of the tracer can be achieved.  Table salt is commonly used for measurement because it is cheap and practical for field measurement, and the concentration and durations are small compared to <a class="reference external" href="https://doi.org/10.1016/j.envpol.2017.01.040">observed levels of toxicity</a><span class="math notranslate nohighlight">\(^{[2]}\)</span>.</p>
<p>This notebook introduces the instrument calibration and measurement data processing for a salt dilution streamflow measurement using the slug tracer method.  More information on the steady-state method can be found <a class="reference external" href="https://citeseerx.ist.psu.edu/viewdoc/download?doi=10.1.1.454.1620&amp;rep=rep1&amp;type=pdf&amp;bcgovtm=new%20west%20record">here</a>.  At the end of this notebook, there is an open ended question that asks you to reflect on the content of the notebook.</p>
<section id="given-information">
<h3>Given Information:<a class="headerlink" href="#given-information" title="Permalink to this headline">#</a></h3>
<table class="colwidths-auto table">
<thead>
<tr class="row-odd"><th class="head"><p>Parameter</p></th>
<th class="head"><p>Value</p></th>
<th class="head"><p>Units</p></th>
</tr>
</thead>
<tbody>
<tr class="row-even"><td><p>Date of Measurement</p></td>
<td><p>26 September 2010</p></td>
<td><p>-</p></td>
</tr>
<tr class="row-odd"><td><p>Mass of Injected Salt</p></td>
<td><p>100</p></td>
<td><p>kg</p></td>
</tr>
<tr class="row-even"><td><p>Calibration Solution</p></td>
<td><p>10.1</p></td>
<td><p><span class="math notranslate nohighlight">\(\frac{g}{L}\)</span></p></td>
</tr>
<tr class="row-odd"><td><p>Calibration Volume</p></td>
<td><p>500</p></td>
<td><p><span class="math notranslate nohighlight">\(mL\)</span></p></td>
</tr>
<tr class="row-even"><td><p>Calibration increments</p></td>
<td><p>1.1</p></td>
<td><p><span class="math notranslate nohighlight">\(mL\)</span></p></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="import-the-salt-dilution-data">
<h2>Import the Salt Dilution Data<a class="headerlink" href="#import-the-salt-dilution-data" title="Permalink to this headline">#</a></h2>
<p>In a salt dilution measurement, we first calibrate the instrument using known concentrations of salt solution.</p>
<p>The calibration data is provided in a file named <strong>SD_cal.csv</strong>, and it’s saved under:</p>
<blockquote>
<div><p><code class="docutils literal notranslate"><span class="pre">&lt;project</span> <span class="pre">root&gt;/content/notebook_data/notebook_1_data/</span></code>.</p>
</div></blockquote>
<p>If you haven’t done so, review the different ways we can specify file paths and navigate file structure in the <span class="xref myst">Data Import and Review</span> notebook.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">data_file_path</span> <span class="o">=</span> <span class="s1">&#39;../../notebook_data/notebook_1_data/&#39;</span>
<span class="n">calibration_filename</span> <span class="o">=</span> <span class="s1">&#39;SD_cal.csv&#39;</span> <span class="c1"># this is the calibration data file</span>
<span class="n">salt_dilution_filename</span> <span class="o">=</span> <span class="s1">&#39;SD_data.csv&#39;</span> <span class="c1"># this is the measurement data file</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># instrument calibration data</span>
<span class="c1"># see how two strings can be combined with the &#39;+&#39; operator</span>
<span class="nb">print</span><span class="p">(</span><span class="n">data_file_path</span> <span class="o">+</span> <span class="n">calibration_filename</span><span class="p">)</span>
<span class="n">sd_cal</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_file_path</span> <span class="o">+</span> <span class="n">calibration_filename</span><span class="p">)</span>

<span class="c1"># discharge measurement data</span>
<span class="n">sd_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">data_file_path</span> <span class="o">+</span> <span class="n">salt_dilution_filename</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>../../notebook_data/notebook_1_data/SD_cal.csv
</pre></div>
</div>
</div>
</div>
<p>Here we specify some known quantities concerning the calibration of our measurement device.  This information was recorded by the field staff and can be found in the SD_cal spreadsheet:</p>
<p><img alt="Measurement calibration information found in the calibration spreadsheet file." src="../../_images/sd_cal_sheet.png" /></p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># data given in the calibration file</span>
<span class="n">cal_solution_concn</span> <span class="o">=</span> <span class="mf">10.0</span> <span class="c1"># g/L - this is the NaCl concentration in the calibration solution (column A, row 11)</span>
<span class="n">cal_vol</span> <span class="o">=</span> <span class="mi">500</span> <span class="c1"># total calibration volume mL  (row 2 of Calibration volume column)</span>
<span class="n">cal_vol_increment</span> <span class="o">=</span> <span class="mf">1.0</span> <span class="c1"># [mL] increments for calibration solution (Calibration solution added (ml) column)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># display a preview of the calibration data</span>
<span class="n">sd_cal</span><span class="o">.</span><span class="n">head</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Calibration volume (ml)</th>
      <th>Calibration solution added (ml)</th>
      <th>Salt added (mg)</th>
      <th>Concentration (mg/l)</th>
      <th>Conductivity (microSiemens/cm)</th>
      <th>Temperature (C)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>500</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>303.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>NaN</td>
      <td>1.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>343.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>NaN</td>
      <td>2.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>380.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>NaN</td>
      <td>3.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>426.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>NaN</td>
      <td>4.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>464.0</td>
      <td>10.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
<blockquote>
<div><p><strong>Note</strong>: several columns contain <code class="docutils literal notranslate"><span class="pre">NaN</span></code>.  We need to update these columns based on the calibration procedure.</p>
</div></blockquote>
<p>The calibration procedure is as follows:</p>
<ol class="simple">
<li><p>Collect a sample of river water with a known volume (500mL is the first entry in the <code class="docutils literal notranslate"><span class="pre">Calibration</span> <span class="pre">Volume</span> <span class="pre">(ml)</span></code> column.)  Let’s call this the <strong>control sample</strong>.</p></li>
<li><p>Measure the baseline conductivity of the control sample.</p></li>
<li><p>Add a known volume of calibration solution to the control sample (the <code class="docutils literal notranslate"><span class="pre">Calibration</span> <span class="pre">solution</span> <span class="pre">added</span> <span class="pre">(ml)</span></code> column indicates how much solution we add at each calibration step.  In this case, it’s 1.0 millilitres.</p></li>
<li><p>Measure the conductivity of the control sample.</p></li>
<li><p>Repeat steps 3-4 until five measurements are recorded.</p></li>
</ol>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># update the calibration solution added column for the volume of calibration solution added during the calibration</span>
<span class="c1"># note that the index column can be used as a multiplier to give the correct cumulative calibration volume added</span>
<span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Calibration solution added (ml)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal_vol_increment</span> <span class="o">*</span> <span class="n">sd_cal</span><span class="o">.</span><span class="n">index</span>

<span class="c1">#  add the volume of solution to the calibration volume</span>
<span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Calibration volume (ml)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">cal_vol</span> <span class="o">+</span> <span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Calibration solution added (ml)&#39;</span><span class="p">]</span>

<span class="c1"># calculate the equivalent salt mass added from the calibration solution volume</span>
<span class="c1"># and the calibration solution concentration.</span>
<span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Salt added (mg)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Calibration solution added (ml)&#39;</span><span class="p">]</span> <span class="o">*</span> <span class="n">cal_solution_concn</span>
<span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Concentration (mg/l)&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Salt added (mg)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Calibration volume (ml)&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="mi">1000</span><span class="p">)</span>

<span class="c1"># drop empty rows</span>
<span class="n">sd_cal</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">,</span> <span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># see how the calibration data has been updated</span>
<span class="n">sd_cal</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Calibration volume (ml)</th>
      <th>Calibration solution added (ml)</th>
      <th>Salt added (mg)</th>
      <th>Concentration (mg/l)</th>
      <th>Conductivity (microSiemens/cm)</th>
      <th>Temperature (C)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>500.0</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>303.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>501.0</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>19.960080</td>
      <td>343.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>502.0</td>
      <td>2.0</td>
      <td>20.0</td>
      <td>39.840637</td>
      <td>380.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>503.0</td>
      <td>3.0</td>
      <td>30.0</td>
      <td>59.642147</td>
      <td>426.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>504.0</td>
      <td>4.0</td>
      <td>40.0</td>
      <td>79.365079</td>
      <td>464.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>5</th>
      <td>505.0</td>
      <td>5.0</td>
      <td>50.0</td>
      <td>99.009901</td>
      <td>505.0</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>6</th>
      <td>506.0</td>
      <td>6.0</td>
      <td>60.0</td>
      <td>118.577075</td>
      <td>546.0</td>
      <td>10.8</td>
    </tr>
  </tbody>
</table>
</div></div></div>
</div>
</section>
<section id="plot-the-calibration-and-best-fit-line">
<h2>Plot the calibration and best fit line<a class="headerlink" href="#plot-the-calibration-and-best-fit-line" title="Permalink to this headline">#</a></h2>
<p>The sevel calibration points are plotted below as a series of red circles.  The best fit line through the calibration points is represented by a dashed blue line.</p>
<blockquote>
<div><p><strong>Note</strong>:  More information on specifying the appearance of plots can be found in the <a class="reference external" href="https://matplotlib.org/3.1.0/api/markers_api.html#module-matplotlib.markers">matplotlib documentation</a>. In the plot below, the red circle is specified by the short-form string <code class="docutils literal notranslate"><span class="pre">'ro'</span></code> and the dashed blue line is specified by the three character code <code class="docutils literal notranslate"><span class="pre">'b--'</span></code>.</p>
</div></blockquote>
<p>The <code class="docutils literal notranslate"><span class="pre">stats.linregress</span></code> function takes in two arrays and returns the equation of the best fit line through the data, along with information about the fit.  Note that the r-value is the correlation coefficient.  The coefficient of determination (<span class="math notranslate nohighlight">\(R^2\)</span>) is the correlation coefficient squared.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># initialize a single figure (the values 1, 1 can be changed to create a grid of plots)</span>
<span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># the .to_numpy() attribute converts to a vector in order to do vector operations</span>
<span class="n">cond_series</span> <span class="o">=</span> <span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Conductivity (microSiemens/cm)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">conc_series</span> <span class="o">=</span> <span class="n">sd_cal</span><span class="p">[</span><span class="s1">&#39;Concentration (mg/l)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="c1"># add the calibration points to the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">cond_series</span><span class="p">,</span> <span class="n">conc_series</span><span class="p">,</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Calibration Points&quot;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Temperature Compenstated Conductivity [uS/cm]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Control Volume Salt Concentration [mg/l]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Salt Dilution Measurement Calibration&#39;</span><span class="p">)</span>

<span class="c1"># add best fit line</span>
<span class="n">results</span> <span class="o">=</span> <span class="n">stats</span><span class="o">.</span><span class="n">linregress</span><span class="p">(</span><span class="n">cond_series</span><span class="p">,</span> <span class="n">conc_series</span><span class="p">)</span>
<span class="c1"># the stats.linregress output is a 5-tuple, r_value is the correlation coefficient</span>
<span class="n">slope</span><span class="p">,</span> <span class="n">intercept</span><span class="p">,</span> <span class="n">r_value</span><span class="p">,</span> <span class="n">p_value</span><span class="p">,</span> <span class="n">std_err</span> <span class="o">=</span> <span class="n">results</span>

<span class="c1">#  create an array between the minimum and maximum calibration points</span>
<span class="n">x_range</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linspace</span><span class="p">(</span><span class="n">cond_series</span><span class="o">.</span><span class="n">min</span><span class="p">(),</span> <span class="n">cond_series</span><span class="o">.</span><span class="n">max</span><span class="p">(),</span>  <span class="mi">100</span><span class="p">)</span>

<span class="c1"># use the best fit slope and intercept to construct the best fit line</span>
<span class="n">best_fit</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="o">*</span> <span class="n">slope</span> <span class="o">+</span> <span class="n">intercept</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">x_range</span><span class="p">]</span>

<span class="c1"># add the best fit line to the plot</span>
<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">x_range</span><span class="p">,</span> <span class="n">best_fit</span><span class="p">,</span> <span class="s1">&#39;b--&#39;</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Best Fit (R^2 = </span><span class="si">{:.2f}</span><span class="s1">)&#39;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">r_value</span><span class="o">**</span><span class="mi">2</span><span class="p">))</span>
<span class="c1"># by default a legend is not shown, so we need to call the attribute.</span>
<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7ff91e9ed0c0&gt;
</pre></div>
</div>
<img alt="../../_images/Notebook_1_13_1.png" src="../../_images/Notebook_1_13_1.png" />
</div>
</div>
<section id="best-fit-slope-and-coefficient-of-determination-r-2-of-calibration-points">
<h3>Best Fit slope and coefficient of determination (<span class="math notranslate nohighlight">\(R^2\)</span>) of calibration points<a class="headerlink" href="#best-fit-slope-and-coefficient-of-determination-r-2-of-calibration-points" title="Permalink to this headline">#</a></h3>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1">#note: the number of decimals in the slope is too low. adjust the line below to print one more decimal.</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The calibration best fit slope is </span><span class="si">{</span><span class="n">slope</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> [[mg/L] / [uS/cm]]&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The coefficient of determination of the calibration is </span><span class="si">{</span><span class="n">r_value</span><span class="o">**</span><span class="mi">2</span><span class="si">:</span><span class="s2">.3f</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The calibration best fit slope is 0.49 [[mg/L] / [uS/cm]]
The coefficient of determination of the calibration is 1.000.
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p><strong>Note</strong>: Above, the print statement string has an <code class="docutils literal notranslate"><span class="pre">f</span></code> before the opening quotation <code class="docutils literal notranslate"><span class="pre">&quot;</span></code>, which enables the insertion of variables into the string.  This is done using the <code class="docutils literal notranslate"><span class="pre">{}</span></code> symbol and a ‘type’ specifier.  In this case, the values inside the curly brackets <code class="docutils literal notranslate"><span class="pre">{slope:.2f}</span></code> means I want a <strong>float</strong> of <strong>2</strong> decimal places.  There are a number of ways to insert variables into strings for output.  More information on string formatting can be <a class="reference external" href="https://www.python.org/dev/peps/pep-3101/">found here</a>.</p>
</div></blockquote>
</section>
</section>
<section id="flow-measurement">
<h2>Flow measurement<a class="headerlink" href="#flow-measurement" title="Permalink to this headline">#</a></h2>
<section id="plot-the-salt-dilution-measurement">
<h3>Plot the salt dilution measurement<a class="headerlink" href="#plot-the-salt-dilution-measurement" title="Permalink to this headline">#</a></h3>
<p>Now we’ll use the second data file.  Recall that the first file was for calibration.  The EC sensor was placed in a measured volume of water, and calibration solution was added in measured amounts to record the change in conductivity.</p>
<p>For the actual measurement of flow in the creek, the EC sensor is placed in the creek some distance downstream of the where a known mass of salt is deposited and mixed.</p>
<p>Below we plot the conductivity over time, and we also determine what the ‘background’ conductivity was in order to calculate the area under the conductivity curve.  It turns out there is a lot of interesting information about runoff processes contained in the background EC signal.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sd_data</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Time (s)</th>
      <th>ECT (uS/cm)</th>
      <th>Temperature (C)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1</td>
      <td>298</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2</td>
      <td>298</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>2</th>
      <td>3</td>
      <td>298</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>3</th>
      <td>4</td>
      <td>298</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>4</th>
      <td>5</td>
      <td>298</td>
      <td>10.8</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>863</th>
      <td>864</td>
      <td>298</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>864</th>
      <td>865</td>
      <td>298</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>865</th>
      <td>866</td>
      <td>298</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>866</th>
      <td>867</td>
      <td>298</td>
      <td>10.5</td>
    </tr>
    <tr>
      <th>867</th>
      <td>868</td>
      <td>298</td>
      <td>10.5</td>
    </tr>
  </tbody>
</table>
<p>868 rows × 3 columns</p>
</div></div></div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># we can also plot directly from a dataframe</span>
<span class="n">sd_data</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">,</span> <span class="s1">&#39;ECT (uS/cm)&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;AxesSubplot: xlabel=&#39;Time (s)&#39;&gt;
</pre></div>
</div>
<img alt="../../_images/Notebook_1_19_1.png" src="../../_images/Notebook_1_19_1.png" />
</div>
</div>
</section>
<section id="specify-background-and-measurement-periods">
<h3>Specify background and measurement periods<a class="headerlink" href="#specify-background-and-measurement-periods" title="Permalink to this headline">#</a></h3>
<p>We need to establish the background conductivity, or the natural conductivity of the stream prior to the measurement.  Use the plot above to establish a first guess at both the background period and the measurement period.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># the background is the natural level of conductivity prior to the salt injection</span>
<span class="n">start_bg</span> <span class="o">=</span> <span class="mi">0</span>  <span class="c1"># set the time (in seconds) for the start point of the background</span>
<span class="n">end_bg</span> <span class="o">=</span> <span class="mi">150</span>  <span class="c1"># set the time (in seconds) for the end point of the background</span>

<span class="c1"># start and end time of the measurement (seconds)</span>
<span class="n">msmt_start</span> <span class="o">=</span> <span class="mi">190</span>
<span class="n">msmt_end</span> <span class="o">=</span> <span class="mi">700</span>

<span class="c1"># here, the mean of the background over a certain period is calculated as the representative background EC.T</span>
<span class="n">background_ect</span> <span class="o">=</span> <span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;ECT (uS/cm)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">start_bg</span><span class="p">:</span> <span class="n">end_bg</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span><span class="mi">6</span><span class="p">))</span>

<span class="c1"># plot the conductivity vs. time</span>
<span class="n">t</span> <span class="o">=</span> <span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>
<span class="n">ec_t</span> <span class="o">=</span> <span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;ECT (uS/cm)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">to_numpy</span><span class="p">()</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">,</span> <span class="n">ec_t</span><span class="p">,</span> <span class="n">label</span><span class="o">=</span><span class="s2">&quot;Conductivity (microSiemens/cm)&quot;</span><span class="p">)</span>

<span class="c1"># label the axes, and set the plot title</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;Elapsed Time (s)&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;Temp. Compenstated Conductivity [uS/cm]&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_title</span><span class="p">(</span><span class="s1">&#39;Salt Dilution Measurement&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">t</span><span class="p">[</span><span class="n">start_bg</span><span class="p">:</span> <span class="n">end_bg</span><span class="p">],</span> 
        <span class="n">ec_t</span><span class="p">[</span><span class="n">start_bg</span><span class="p">:</span> <span class="n">end_bg</span><span class="p">],</span> <span class="s1">&#39;ro&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Background&#39;</span><span class="p">)</span>

<span class="n">ax</span><span class="o">.</span><span class="n">plot</span><span class="p">((</span><span class="n">t</span><span class="p">[</span><span class="n">msmt_start</span><span class="p">],</span> <span class="n">t</span><span class="p">[</span><span class="n">msmt_end</span><span class="p">]),</span>
        <span class="p">(</span><span class="n">ec_t</span><span class="p">[</span><span class="n">msmt_start</span><span class="p">],</span> <span class="n">ec_t</span><span class="p">[</span><span class="n">msmt_end</span><span class="p">]),</span> <span class="s1">&#39;go&#39;</span><span class="p">,</span>
        <span class="n">label</span><span class="o">=</span><span class="s1">&#39;Measurement Start &amp; End&#39;</span><span class="p">)</span>

<span class="n">plt</span><span class="o">.</span><span class="n">legend</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&lt;matplotlib.legend.Legend at 0x7ff91c8b2800&gt;
</pre></div>
</div>
<img alt="../../_images/Notebook_1_22_1.png" src="../../_images/Notebook_1_22_1.png" />
</div>
</div>
</section>
</section>
<section id="calculate-discharge">
<h2>Calculate Discharge<a class="headerlink" href="#calculate-discharge" title="Permalink to this headline">#</a></h2>
<p>The volumetric flow (discharge) is equal to the area under the salt dilution curve, minus the background EC.</p>
<p>Calculate the area under the curve:</p>
<p>The area is: $<span class="math notranslate nohighlight">\(A_{curve} = \sum_{i=start}^{end} (ECT_i - ECT_{BG,i}) \cdot Slope_{calibration} \cdot t_{step,i} = \frac{\mu S}{cm} \cdot \frac {mg/L}{\mu S/cm} \cdot s = \frac {mg}{L} \cdot s\)</span><span class="math notranslate nohighlight">\(
Then discharge (Q) is calculated by: \)</span>\frac{m_{salt}}{A_{curve}} = \frac{M\cdot kg \cdot \frac{1x10^6 mg}{1kg}}{\frac {mg}{L} \cdot \frac{1000 L}{1m^3} \cdot s} = \frac {m^3}{s}$</p>
<p>To illustrate, we are calculating the total area under the curve:</p>
<p><img alt="Area under conductivity curve" src="../../_images/a1.png" /></p>
<p>And we are subtracting the rectangle representing the background.</p>
<p><img alt="Background Area" src="../../_images/a2.png" /></p>
<p>In the cell below, we calculate the area under the conductivity curve (<code class="docutils literal notranslate"><span class="pre">ECT</span> <span class="pre">(uS/cm</span></code>) and subtract the background average determined above.  We do this by finite-difference, which is simply adding up all the little rectangles that approximate the green region in the diagram above.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># subtract the background and multiply by the calibration slope </span>
<span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;Concentration&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;ECT (uS/cm)&#39;</span><span class="p">]</span> <span class="o">-</span> <span class="n">background_ect</span><span class="p">)</span> <span class="o">*</span> <span class="n">slope</span>
</pre></div>
</div>
</div>
</div>
<p>Check the time step duration.  We know from the column header the time units are in seconds (s), and we could look at the values and hard-code the time step, but it’s better to not assume or hard code values, so we will use the actual time step by calling the <code class="docutils literal notranslate"><span class="pre">.diff()</span></code> function on the <code class="docutils literal notranslate"><span class="pre">Time</span> <span class="pre">(s)</span></code> column to get a row-wise difference.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">diff</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># trim the time series to the start and end time</span>
<span class="n">msmt_slice</span> <span class="o">=</span> <span class="n">sd_data</span><span class="p">[(</span><span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">msmt_start</span><span class="p">)</span> <span class="o">&amp;</span> <span class="p">(</span><span class="n">sd_data</span><span class="p">[</span><span class="s1">&#39;Time (s)&#39;</span><span class="p">]</span> <span class="o">&lt;</span> <span class="n">msmt_end</span><span class="p">)]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># approximating the area under the curve as the sum of small </span>
<span class="c1"># rectangles of height &#39;concentration&#39; and widths of 1 time step</span>
<span class="n">concentration_area</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">msmt_slice</span><span class="p">[</span><span class="s1">&#39;Concentration&#39;</span><span class="p">],</span> <span class="n">msmt_slice</span><span class="p">[</span><span class="s1">&#39;time_step&#39;</span><span class="p">]))</span>
</pre></div>
</div>
</div>
</div>
<blockquote>
<div><p><strong>Note</strong>: The <code class="docutils literal notranslate"><span class="pre">np.muliply()</span></code> function used above does element-wise multiplication.  i.e. if <span class="math notranslate nohighlight">\(a=[0, 1, 2]\)</span> and <span class="math notranslate nohighlight">\(b=[3, 4, 5]\)</span>, <code class="docutils literal notranslate"><span class="pre">np.multiply(a,</span> <span class="pre">b)</span> <span class="pre">=</span> <span class="pre">[0,</span> <span class="pre">4,</span> <span class="pre">10]</span></code>.  Consider what would happen if our timestep was not uniform and we used a constant multiplier to calculate area under the curve.</p>
</div></blockquote>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">a</span> <span class="o">=</span> <span class="p">[</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">]</span>
<span class="n">b</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">]</span>
<span class="n">np</span><span class="o">.</span><span class="n">multiply</span><span class="p">(</span><span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>array([ 0,  4, 10])
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mass</span> <span class="o">=</span> <span class="mi">100</span> <span class="c1"># 1 kg &quot;slug&quot; of salt (NaCl) was put in the river (as recorded in the SD_cal spreadsheet, shown previously)</span>

<span class="c1"># see the &quot;Calculate Discharge&quot; section above to convince yourself that the units work out</span>
<span class="n">Q_calculated</span> <span class="o">=</span> <span class="n">mass</span> <span class="o">*</span> <span class="mi">1000</span> <span class="o">/</span> <span class="n">concentration_area</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;The calculated discharge for the measurement is </span><span class="si">{</span><span class="n">Q_calculated</span><span class="si">:</span><span class="s1">.1f</span><span class="si">}</span><span class="s1"> m^3/s&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>The calculated discharge for the measurement is 11.9 m^3/s
</pre></div>
</div>
</div>
</div>
</section>
<section id="notebook-reflection">
<h2>Notebook Reflection<a class="headerlink" href="#notebook-reflection" title="Permalink to this headline">#</a></h2>
<p>In this notebook, we demonstrated how a salt dilution measurement is processed, including calibration and calculation of volumetric flow.  There are a number of sources of uncertainty in this process.  Provide short written responses to the questions below.  It is recommended to use this notebook to get a sense of the sensitivity of the resulting volumetric flow calculation to various input parameters.</p>
<p>Near the start of the notebook, we set variables associated with the calibration of the EC sensor:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">cal_vol</span></code>: the volume of water from the stream used as the baseline for calibration,</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cal_solution_concn</span></code>: the concentration of our calibration solution, and</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">cal_vol_increment</span></code>: the incremental volume of calibration solution added to the calibration volume</p></li>
</ul>
<section id="question-1">
<h3>Question 1:<a class="headerlink" href="#question-1" title="Permalink to this headline">#</a></h3>
<p>Comment on the effect of errors in the <em>accuracy</em> of the three calibration variables.  Which variable results in the greatest change to the calculated discharge if the variable is changed by +/- 10%?  In other words, what is the <em>sensitivity</em> of the result (measured flow) to each of the three calibration variables, in relative, qualitative terms?</p>
</section>
<section id="question-2">
<h3>Question 2:<a class="headerlink" href="#question-2" title="Permalink to this headline">#</a></h3>
<p>Above, we manually set the start and end of the salt injection measurement (marked in the plot by the green dots) using the <code class="docutils literal notranslate"><span class="pre">msmt_start</span></code> and <code class="docutils literal notranslate"><span class="pre">msmt_end</span></code> variables.  In some flow conditions, the EC reading will take a very long time to return to baseline.  The realities of field work (time constraints, battery power, etc) occassionally result in the ‘tail’ of the measurement curve being cut off.  What happens to the calculated discharge if the EC measurement stops unexpectedly before the EC returns to baseline?  Go back in the notebook and change the <code class="docutils literal notranslate"><span class="pre">msmt_end</span></code> time and comment on the effect on the calculated discharge.</p>
</section>
</section>
<section id="additional-info">
<h2>Additional Info<a class="headerlink" href="#additional-info" title="Permalink to this headline">#</a></h2>
<section id="temperature-compensation-for-conductivity">
<h3>Temperature Compensation for Conductivity<a class="headerlink" href="#temperature-compensation-for-conductivity" title="Permalink to this headline">#</a></h3>
<p>The electrical conductivity (EC) of water is a function of temperature, so it is important that the water used for calibration is the same temperature as the water in the stream being measured.  Alternatively, a temperature correction can be applied.  For the data in this notebook, the instrument used for flow measurement has a thermometer, so temperature compensation is built into the instrument.</p>
<p>Two different methods of temperature compensation are provided below for reference, the first is an <a class="reference external" href="https://standards.iteh.ai/catalog/standards/cen/3978cdbc-b72f-459e-9275-99e7fc2b4b84/en-27888-1993">EU standard for the determination of electrical conductivity</a>, and the second is a <span class="xref myst">linear approximation of conductivity</span><span class="math notranslate nohighlight">\(^{[3]}\)</span> as a function of temperature.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">eu_std_ect_adjust</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">ec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes in a temperature (Theta), and an EC value,</span>
<span class="sd">    returns a temperature adjusted ECT value</span>
<span class="sd">    based on EU standard 27888 conversion.</span>
<span class="sd">        Input:  -temperature (Celsius)</span>
<span class="sd">                -electrical conductivity</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">c1</span> <span class="o">=</span> <span class="o">-</span><span class="mf">0.198058</span>
    <span class="n">c2</span> <span class="o">=</span> <span class="o">-</span><span class="mf">1.992186</span>
    <span class="n">c3</span> <span class="o">=</span> <span class="mf">231.17628</span>
    <span class="n">c4</span> <span class="o">=</span> <span class="mf">86.39123</span>
    <span class="n">r</span> <span class="o">=</span> <span class="n">c1</span> <span class="o">+</span> <span class="n">math</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">c2</span> <span class="o">+</span> <span class="n">c3</span> <span class="o">/</span> <span class="p">(</span><span class="n">temp</span> <span class="o">+</span> <span class="n">c4</span><span class="p">))</span>
    <span class="n">c5</span> <span class="o">=</span> <span class="mf">0.962144</span>
    <span class="n">c6</span> <span class="o">=</span> <span class="mf">0.965078</span>
    <span class="n">c7</span> <span class="o">=</span> <span class="mf">1.116</span>
    <span class="n">f25</span> <span class="o">=</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">c5</span><span class="p">)</span> <span class="o">+</span> <span class="n">c5</span> <span class="o">*</span> <span class="p">(</span><span class="n">r</span><span class="o">**</span><span class="n">c6</span><span class="p">))</span> <span class="o">*</span> <span class="n">c7</span>
    <span class="k">return</span> <span class="n">ec</span> <span class="o">*</span> <span class="n">f25</span>

<span class="k">def</span> <span class="nf">linear2_ect_adjust</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">ec</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Takes in a temperature (temp), and an EC value (ec),</span>
<span class="sd">    returns a temperature adjusted ECT value</span>
<span class="sd">    based on linear interpolation assuming</span>
<span class="sd">    2.5% per degree centigrade. (Smith, 1962)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">f25</span> <span class="o">=</span> <span class="mf">2.5</span>
    <span class="k">return</span> <span class="n">ec</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="p">(</span><span class="n">f25</span> <span class="o">/</span><span class="mi">100</span><span class="p">)</span> <span class="o">*</span> <span class="p">(</span><span class="n">temp</span> <span class="o">-</span> <span class="mi">25</span><span class="p">))</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Apply temperature compensation to the measured conductivity</span>
<span class="n">temp_compensated</span> <span class="o">=</span> <span class="p">[]</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">sd_cal</span><span class="o">.</span><span class="n">iterrows</span><span class="p">():</span>
    <span class="n">conductivity</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Conductivity (microSiemens/cm)&#39;</span><span class="p">]</span>
    <span class="n">temperature</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;Temperature (C)&#39;</span><span class="p">]</span>

    <span class="c1"># for each value in the conductivity time series,</span>
    <span class="c1"># apply the function to correct for temperature,</span>
    <span class="c1"># and add to the temp compensated array</span>
    <span class="n">temp_ec</span> <span class="o">=</span> <span class="n">eu_std_ect_adjust</span><span class="p">(</span><span class="n">temp</span><span class="o">=</span><span class="n">temperature</span><span class="p">,</span> <span class="n">ec</span><span class="o">=</span><span class="n">conductivity</span><span class="p">)</span>
    
    <span class="n">temp_compensated</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">temp_ec</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>
<section id="references">
<h2>References<a class="headerlink" href="#references" title="Permalink to this headline">#</a></h2>
<ol class="simple">
<li><p>Kite, Geoff. “Computerized streamflow measurement using slug injection.” <em>Hydrological processes</em> 7.2 (1993): 227-233.</p></li>
<li><p>Hintz, William D., and Rick A. Relyea. “Impacts of road deicing salts on the early-life growth and development of a stream salmonid: salt type matters.” <em>Environmental pollution</em> 223 (2017): 409-415.</p></li>
<li><p>Smith, Stanford H. “TEMPERATURE CORRECTION IN CONDUCTIVITY MEASUREMENTS 1.” <em>Limnology and Oceanography</em> 7.3 (1962): 330-334.</p></li>
</ol>
</section>
</section>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            kernelName: "python3",
            path: "./notebooks/Notebook_1"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

              </div>
              
            </main>
            <footer class="footer-article noprint">
                
    <!-- Previous / next buttons -->
<div class='prev-next-area'>
    <a class='left-prev' id="prev-link" href="../Introduction/Example_Notebook.html" title="previous page">
        <i class="fas fa-angle-left"></i>
        <div class="prev-next-info">
            <p class="prev-next-subtitle">previous</p>
            <p class="prev-next-title">Example: Clausius-Clapeyron Equation</p>
        </div>
    </a>
    <a class='right-next' id="next-link" href="../Notebook_2/Notebook_2.html" title="next page">
    <div class="prev-next-info">
        <p class="prev-next-subtitle">next</p>
        <p class="prev-next-title">Notebook 2: Rating Curve Development</p>
    </div>
    <i class="fas fa-angle-right"></i>
    </a>
</div>
            </footer>
        </div>
    </div>
    <div class="footer-content row">
        <footer class="col footer"><p>
  
    By Dan Kovacek<br/>
  
      &copy; Copyright 2022.<br/>
</p>
        </footer>
    </div>
    
</div>


      </div>
    </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script src="../../_static/scripts/pydata-sphinx-theme.js?digest=1999514e3f237ded88cf"></script>


  </body>
</html>